#!/bin/sh
# bin/compile BUILD_DIR CACHE_DIR ENV_DIR

NAME=apache-couchdb-2.1.1
URL=http://apache.mirrors.lucidnetworks.net/couchdb/source/2.1.1/$NAME.tar.gz
LOG=$BUILD_DIR/log

echo $(which escript)

download() {
    cd $CACHE_DIR
    echo "download"
    wget $URL
    echo "extract"
    tar -xvf $NAME.tar.gz
    echo "ls before cd - "
    echo "$(ls)"
    cd -
    echo "ls after cd - "
    echo "$(ls)"
}

install() {
    echo "$(ls ../)"
    cd $CACHE_DIR/$NAME
    echo "configure"
    #./configure
    echo "release"
    #make release
    echo "copy to build dir"
    #cp ./rel/couchdb $BUILD_DIR/etc/couchdb
    cd -
}

setup() {
    echo "create user"
    # adduser --system \
    #         --no-create-home \
    #         --shell /bin/bash \
    #         --group --gecos \
    #         "CouchDB Administrator" couchdb

    echo "set owner"
    # chown -R couchdb:couchdb $BUILD_DIR/etc/couchdb/couchdb

    echo "set permissions"
    # find $BUILD_DIR/etc/couchdb/couchdb -type d -exec chmod 0770 {} \;
    # chmod 0644 $BUILD_DIR/etc/couchdb/couchdb/etc/*
}

download && install && setup

echo "done"
